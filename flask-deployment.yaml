# ---------------------------------------------------------------------
# ‚ò∏Ô∏è  LLMOps Flipkart Product Recommender ‚Äî Kubernetes Manifest
# ---------------------------------------------------------------------
# This manifest defines the Kubernetes Deployment and Service
# for running the Flask backend of the Flipkart Product Recommender.
#
# The Deployment runs a single replica of the Flask container,
# configured to pull environment variables securely from Kubernetes Secrets.
# The Service exposes the Flask application externally via a LoadBalancer.
# ---------------------------------------------------------------------

# --------------------------------------------------------------
# üß© Deployment ‚Äî Flask Application
# --------------------------------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: flask-app
  labels:
    app: flask
spec:
  # Number of pods to run (scalable if needed)
  replicas: 1

  # Pod selection criteria
  selector:
    matchLabels:
      app: flask

  # Pod template specification
  template:
    metadata:
      labels:
        app: flask
    spec:
      containers:
        - name: flask-container
          # Docker image built from the project‚Äôs Dockerfile
          image: flask-app:latest
          # Prevents pulling if the image already exists locally
          imagePullPolicy: IfNotPresent
          # Application port exposed by the container
          ports:
            - containerPort: 5000
          # Load environment variables from Kubernetes Secrets
          envFrom:
            - secretRef:
                name: llmops-secrets

---
# --------------------------------------------------------------
# üåê Service ‚Äî External Access via LoadBalancer
# --------------------------------------------------------------
apiVersion: v1
kind: Service
metadata:
  name: flask-service
spec:
  # Expose the Flask app to the internet
  type: LoadBalancer

  # Route traffic to pods matching this label
  selector:
    app: flask

  # Map external port 80 to container port 5000
  ports:
    - protocol: TCP
      port: 80
      targetPort: 5000
